<IfModule mod_ssl.c>

# The default https (443) port is for read-only access
<VirtualHost _default_:<%= @read_port%>>
  ServerName <%= @server_name %>
  ServerAdmin webmaster@arcticwolf.com
  DocumentRoot <%= @packages_root %>

  <Directory <%= @packages_root %>>
    Options -Indexes FollowSymLinks MultiViews
    DirectoryIndex never_create_this_file
    AllowOverride None
    Order allow,deny
    allow from all
    SSLRequireSSL
    SSLRequire %{SSL_CLIENT_S_DN_CN} =~ m/<%= @read_user %>/
  </Directory>

  # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
  LogLevel warn
  ErrorLog ${APACHE_LOG_DIR}/aw-packages-error.log
  CustomLog ${APACHE_LOG_DIR}/aw-packages.log combined

  SSLEngine on

  # SSL certificate for this server
  SSLCertificateFile    <%= @ssl_cert %>
  SSLCertificateKeyFile <%= @ssl_key %>

  # The self-signed internal CA file
  SSLCACertificateFile <%= @ssl_ca_cert %>

  # Require our clients to have a signed certificate, max 1 depth from our internal CA file
  SSLVerifyClient require
  SSLVerifyDepth  1
</VirtualHost>

# The 444 port is for read-wrie access via webdav
<VirtualHost _default_:<%= @write_port %>>
  ServerName <%= @server_name %>
  ServerAdmin webmaster@arcticwolf.com
  DocumentRoot <%= @packages_root %>

  <Directory <%= @packages_root %>>
    Options -Indexes FollowSymLinks MultiViews
    DirectoryIndex never_create_this_file
    AllowOverride None
    Order allow,deny
    allow from all
    SSLRequireSSL
    SSLRequire %{SSL_CLIENT_S_DN_CN} =~ m/<%= @write_user %>/
    Dav on
  </Directory>

  # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
  LogLevel warn
  ErrorLog ${APACHE_LOG_DIR}/aw-packages-error.log
  CustomLog ${APACHE_LOG_DIR}/aw-packages.log combined

  SSLEngine on

  # SSL certificate for this server
  SSLCertificateFile    <%= @ssl_cert %>
  SSLCertificateKeyFile <%= @ssl_key %>

  # The self-signed internal CA file
  SSLCACertificateFile <%= @ssl_ca_cert %>

  # Require our clients to have a signed certificate, max 1 depth from our internal CA file
  SSLVerifyClient require
  SSLVerifyDepth  1
</VirtualHost>

</IfModule>
